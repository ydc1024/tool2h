#!/bin/bash

# ‰øÆÂ§çÁºìÂ≠òÊï∞ÊçÆÂ∫ìÈîôËØØÂØºËá¥ÁöÑ500ÈóÆÈ¢ò
# ÂΩªÂ∫ïËß£ÂÜ≥LaravelÁºìÂ≠òÈÖçÁΩÆÈóÆÈ¢ò

echo "üîß ‰øÆÂ§çÁºìÂ≠òÊï∞ÊçÆÂ∫ìÈîôËØØ"
echo "==================="
echo "ÈóÆÈ¢òÔºöLaravelÂ∞ùËØï‰ΩøÁî®Êï∞ÊçÆÂ∫ìÁºìÂ≠ò‰ΩÜË°®‰∏çÂ≠òÂú®"
echo "Ëß£ÂÜ≥ÔºöÂº∫Âà∂‰ΩøÁî®Êñá‰ª∂ÁºìÂ≠òÔºåÂÆåÂÖ®ÈÅøÂºÄÊï∞ÊçÆÂ∫ì‰æùËµñ"
echo ""

# È¢úËâ≤ÂÆö‰πâ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
NC='\033[0m'

log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

log_step() {
    echo -e "${PURPLE}[STEP]${NC} $1"
}

# Ê£ÄÊü•ÊòØÂê¶‰∏∫rootÁî®Êà∑
if [ "$EUID" -ne 0 ]; then
    log_error "ËØ∑‰ΩøÁî® root Áî®Êà∑Êàñ sudo ËøêË°åÊ≠§ËÑöÊú¨"
    exit 1
fi

PROJECT_DIR="/var/www/besthammer_c_usr/data/www/besthammer.club"

log_step "Á¨¨1Ê≠•ÔºöËØäÊñ≠ÂΩìÂâçÈÖçÁΩÆÈóÆÈ¢ò"
echo "-----------------------------------"

cd "$PROJECT_DIR"

# Ê£ÄÊü•ÂΩìÂâç.envÈÖçÁΩÆ
log_info "Ê£ÄÊü•ÂΩìÂâçÁºìÂ≠òÈÖçÁΩÆ..."
if [ -f ".env" ]; then
    CACHE_DRIVER=$(grep "^CACHE_DRIVER=" .env | cut -d'=' -f2)
    SESSION_DRIVER=$(grep "^SESSION_DRIVER=" .env | cut -d'=' -f2)
    DB_CONNECTION=$(grep "^DB_CONNECTION=" .env | cut -d'=' -f2)
    
    log_info "ÂΩìÂâçÈÖçÁΩÆÔºö"
    echo "  CACHE_DRIVER: $CACHE_DRIVER"
    echo "  SESSION_DRIVER: $SESSION_DRIVER"
    echo "  DB_CONNECTION: $DB_CONNECTION"
else
    log_error ".envÊñá‰ª∂‰∏çÂ≠òÂú®"
    exit 1
fi

# Ê£ÄÊü•ÈÖçÁΩÆÁºìÂ≠òÊñá‰ª∂
if [ -f "bootstrap/cache/config.php" ]; then
    log_warning "ÂèëÁé∞ÈÖçÁΩÆÁºìÂ≠òÊñá‰ª∂ÔºåËøôÂèØËÉΩÂØºËá¥ÈÖçÁΩÆ‰∏çÁîüÊïà"
else
    log_info "Êó†ÈÖçÁΩÆÁºìÂ≠òÊñá‰ª∂"
fi

log_step "Á¨¨2Ê≠•ÔºöÂº∫Âà∂Ê∏ÖÁêÜÊâÄÊúâÁºìÂ≠ò"
echo "-----------------------------------"

# Âà†Èô§ÊâÄÊúâÁºìÂ≠òÊñá‰ª∂
log_info "Âà†Èô§ÊâÄÊúâÁºìÂ≠òÊñá‰ª∂..."
rm -rf bootstrap/cache/config.php 2>/dev/null || true
rm -rf bootstrap/cache/routes.php 2>/dev/null || true
rm -rf bootstrap/cache/services.php 2>/dev/null || true
rm -rf storage/framework/cache/* 2>/dev/null || true
rm -rf storage/framework/sessions/* 2>/dev/null || true
rm -rf storage/framework/views/* 2>/dev/null || true

log_success "ÁºìÂ≠òÊñá‰ª∂Â∑≤Ê∏ÖÁêÜ"

log_step "Á¨¨3Ê≠•Ôºö‰øÆÂ§ç.envÈÖçÁΩÆ"
echo "-----------------------------------"

# Â§á‰ªΩ.env
cp .env .env.backup.cache.$(date +%Y%m%d_%H%M%S)

# Âº∫Âà∂ËÆæÁΩÆ‰∏∫Êñá‰ª∂ÁºìÂ≠ò
log_info "Âº∫Âà∂ÈÖçÁΩÆ‰∏∫Êñá‰ª∂ÁºìÂ≠òÊ®°Âºè..."
sed -i "s/^CACHE_DRIVER=.*/CACHE_DRIVER=file/" .env
sed -i "s/^SESSION_DRIVER=.*/SESSION_DRIVER=file/" .env
sed -i "s/^QUEUE_CONNECTION=.*/QUEUE_CONNECTION=sync/" .env

# Â¶ÇÊûúÊ≤°ÊúâËøô‰∫õÈÖçÁΩÆË°åÔºåÂàôÊ∑ªÂä†
if ! grep -q "^CACHE_DRIVER=" .env; then
    echo "CACHE_DRIVER=file" >> .env
fi
if ! grep -q "^SESSION_DRIVER=" .env; then
    echo "SESSION_DRIVER=file" >> .env
fi
if ! grep -q "^QUEUE_CONNECTION=" .env; then
    echo "QUEUE_CONNECTION=sync" >> .env
fi

# ÊöÇÊó∂Á¶ÅÁî®Êï∞ÊçÆÂ∫ìËøûÊé•‰ª•ÈÅøÂÖçÁºìÂ≠òÊ∏ÖÁêÜÊó∂ÁöÑÊï∞ÊçÆÂ∫ìÈîôËØØ
log_info "‰∏¥Êó∂Á¶ÅÁî®Êï∞ÊçÆÂ∫ìËøûÊé•..."
sed -i "s/^DB_CONNECTION=.*/DB_CONNECTION=/" .env

log_success ".envÈÖçÁΩÆÂ∑≤‰øÆÂ§ç"

log_step "Á¨¨4Ê≠•ÔºöÂàõÂª∫Êó†Êï∞ÊçÆÂ∫ì‰æùËµñÁöÑÈÖçÁΩÆ"
echo "-----------------------------------"

# ÂàõÂª∫‰∏¥Êó∂ÁöÑÊï∞ÊçÆÂ∫ìÈÖçÁΩÆÊñá‰ª∂ÔºåÈÅøÂÖçLaravelÂ∞ùËØïËøûÊé•Êï∞ÊçÆÂ∫ì
cat > config/database_temp.php << 'EOF'
<?php

// ‰∏¥Êó∂Êï∞ÊçÆÂ∫ìÈÖçÁΩÆÔºåÈÅøÂÖçÁºìÂ≠òÊ∏ÖÁêÜÊó∂ÁöÑÊï∞ÊçÆÂ∫ìËøûÊé•
return [
    'default' => env('DB_CONNECTION', ''),
    
    'connections' => [
        '' => [
            'driver' => 'sqlite',
            'database' => ':memory:',
        ],
        'mysql' => [
            'driver' => 'mysql',
            'host' => env('DB_HOST', '127.0.0.1'),
            'port' => env('DB_PORT', '3306'),
            'database' => env('DB_DATABASE', 'calculator_platform'),
            'username' => env('DB_USERNAME', 'calculator__usr'),
            'password' => env('DB_PASSWORD', ''),
            'charset' => 'utf8mb4',
            'collation' => 'utf8mb4_unicode_ci',
            'prefix' => '',
            'strict' => true,
            'engine' => null,
        ],
    ],
];
EOF

log_success "‰∏¥Êó∂Êï∞ÊçÆÂ∫ìÈÖçÁΩÆÂ∑≤ÂàõÂª∫"

log_step "Á¨¨5Ê≠•ÔºöÂÆâÂÖ®Ê∏ÖÁêÜLaravelÁºìÂ≠ò"
echo "-----------------------------------"

# ‰ΩøÁî®ÂÆâÂÖ®ÁöÑÊñπÂºèÊ∏ÖÁêÜÁºìÂ≠òÔºåÈÅøÂÖçÊï∞ÊçÆÂ∫ìÊìç‰Ωú
log_info "ÂÆâÂÖ®Ê∏ÖÁêÜLaravelÁºìÂ≠ò..."

# Áõ¥Êé•Âà†Èô§ÁºìÂ≠òÁõÆÂΩïÂÜÖÂÆπËÄå‰∏ç‰ΩøÁî®artisanÂëΩ‰ª§
find storage/framework/cache -name "*.php" -delete 2>/dev/null || true
find storage/framework/sessions -name "*" -not -name ".gitignore" -delete 2>/dev/null || true
find storage/framework/views -name "*.php" -delete 2>/dev/null || true

# Ê∏ÖÁêÜÊó•ÂøóÊñá‰ª∂
find storage/logs -name "*.log" -delete 2>/dev/null || true

log_success "ÁºìÂ≠òÊ∏ÖÁêÜÂÆåÊàê"

log_step "Á¨¨6Ê≠•ÔºöÊÅ¢Â§çÊï∞ÊçÆÂ∫ìÈÖçÁΩÆ"
echo "-----------------------------------"

# ÊÅ¢Â§çÊï∞ÊçÆÂ∫ìËøûÊé•ÈÖçÁΩÆ
log_info "ÊÅ¢Â§çÊï∞ÊçÆÂ∫ìËøûÊé•ÈÖçÁΩÆ..."
sed -i "s/^DB_CONNECTION=.*/DB_CONNECTION=mysql/" .env

# Âà†Èô§‰∏¥Êó∂ÈÖçÁΩÆÊñá‰ª∂
rm -f config/database_temp.php

log_success "Êï∞ÊçÆÂ∫ìÈÖçÁΩÆÂ∑≤ÊÅ¢Â§ç"

log_step "Á¨¨7Ê≠•ÔºöÂàõÂª∫ÁÆÄÂåñÁöÑÂ∑•ÂÖ∑ÊéßÂà∂Âô®"
echo "-----------------------------------"

# ÂàõÂª∫ÂÆåÂÖ®Êó†Êï∞ÊçÆÂ∫ì‰æùËµñÁöÑÊéßÂà∂Âô®
cat > app/Http/Controllers/ToolController.php << 'EOF'
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class ToolController extends Controller
{
    /**
     * Ë¥∑Ê¨æËÆ°ÁÆóÂô®È°µÈù¢
     */
    public function loanCalculator()
    {
        return view('tools.loan-calculator', [
            'locale' => 'en',
            'title' => 'Loan Calculator'
        ]);
    }

    /**
     * Â§öËØ≠Ë®ÄË¥∑Ê¨æËÆ°ÁÆóÂô®È°µÈù¢
     */
    public function localeLoanCalculator($locale)
    {
        app()->setLocale($locale);
        
        return view('tools.loan-calculator', [
            'locale' => $locale,
            'title' => 'Loan Calculator'
        ]);
    }

    /**
     * ËÆ°ÁÆóË¥∑Ê¨æ
     */
    public function calculateLoan(Request $request)
    {
        $request->validate([
            'amount' => 'required|numeric|min:1',
            'rate' => 'required|numeric|min:0',
            'years' => 'required|integer|min:1'
        ]);

        $principal = $request->amount;
        $rate = $request->rate / 100 / 12; // ÊúàÂà©Áéá
        $payments = $request->years * 12; // ÊÄªÊúàÊï∞

        if ($rate > 0) {
            $monthlyPayment = $principal * ($rate * pow(1 + $rate, $payments)) / (pow(1 + $rate, $payments) - 1);
        } else {
            $monthlyPayment = $principal / $payments;
        }

        $totalPayment = $monthlyPayment * $payments;
        $totalInterest = $totalPayment - $principal;

        return response()->json([
            'monthly_payment' => round($monthlyPayment, 2),
            'total_payment' => round($totalPayment, 2),
            'total_interest' => round($totalInterest, 2)
        ]);
    }

    /**
     * BMIËÆ°ÁÆóÂô®È°µÈù¢
     */
    public function bmiCalculator()
    {
        return view('tools.bmi-calculator', [
            'locale' => 'en',
            'title' => 'BMI Calculator'
        ]);
    }

    /**
     * Â§öËØ≠Ë®ÄBMIËÆ°ÁÆóÂô®È°µÈù¢
     */
    public function localeBmiCalculator($locale)
    {
        app()->setLocale($locale);
        
        return view('tools.bmi-calculator', [
            'locale' => $locale,
            'title' => 'BMI Calculator'
        ]);
    }

    /**
     * ËÆ°ÁÆóBMI
     */
    public function calculateBmi(Request $request)
    {
        $request->validate([
            'weight' => 'required|numeric|min:1',
            'height' => 'required|numeric|min:1'
        ]);

        $weight = $request->weight;
        $height = $request->height / 100; // ËΩ¨Êç¢‰∏∫Á±≥

        $bmi = $weight / ($height * $height);
        
        // BMIÂàÜÁ±ª
        if ($bmi < 18.5) {
            $category = 'Underweight';
        } elseif ($bmi < 25) {
            $category = 'Normal weight';
        } elseif ($bmi < 30) {
            $category = 'Overweight';
        } else {
            $category = 'Obese';
        }

        return response()->json([
            'bmi' => round($bmi, 1),
            'category' => $category
        ]);
    }

    /**
     * Ê±áÁéáËΩ¨Êç¢Âô®È°µÈù¢
     */
    public function currencyConverter()
    {
        return view('tools.currency-converter', [
            'locale' => 'en',
            'title' => 'Currency Converter'
        ]);
    }

    /**
     * Â§öËØ≠Ë®ÄÊ±áÁéáËΩ¨Êç¢Âô®È°µÈù¢
     */
    public function localeCurrencyConverter($locale)
    {
        app()->setLocale($locale);
        
        return view('tools.currency-converter', [
            'locale' => $locale,
            'title' => 'Currency Converter'
        ]);
    }

    /**
     * Ë¥ßÂ∏ÅËΩ¨Êç¢
     */
    public function convertCurrency(Request $request)
    {
        $request->validate([
            'amount' => 'required|numeric|min:0',
            'from' => 'required|string|size:3',
            'to' => 'required|string|size:3'
        ]);

        // Ê®°ÊãüÊ±áÁéáÊï∞ÊçÆÔºàÁîü‰∫ßÁéØÂ¢ÉÂ∫îËØ•Ë∞ÉÁî®ÁúüÂÆûAPIÔºâ
        $mockRates = [
            'USD' => 1.0,
            'EUR' => 0.85,
            'GBP' => 0.73,
            'CAD' => 1.25,
            'AUD' => 1.35,
            'CHF' => 0.92,
            'JPY' => 110.0
        ];

        $fromRate = $mockRates[$request->from] ?? 1;
        $toRate = $mockRates[$request->to] ?? 1;
        
        $usdAmount = $request->amount / $fromRate;
        $convertedAmount = $usdAmount * $toRate;

        return response()->json([
            'converted_amount' => round($convertedAmount, 2),
            'exchange_rate' => round($toRate / $fromRate, 4),
            'from_currency' => $request->from,
            'to_currency' => $request->to
        ]);
    }

    /**
     * Ëé∑ÂèñÊ±áÁéáÊï∞ÊçÆ
     */
    public function getExchangeRates()
    {
        // Ê®°ÊãüÊ±áÁéáÊï∞ÊçÆ
        return response()->json([
            'base' => 'USD',
            'rates' => [
                'EUR' => 0.85,
                'GBP' => 0.73,
                'CAD' => 1.25,
                'AUD' => 1.35,
                'CHF' => 0.92,
                'JPY' => 110.0
            ],
            'timestamp' => now()
        ]);
    }
}
EOF

log_success "ÁÆÄÂåñÊéßÂà∂Âô®Â∑≤ÂàõÂª∫"

log_step "Á¨¨8Ê≠•ÔºöËÆæÁΩÆÊ≠£Á°ÆÁöÑÊñá‰ª∂ÊùÉÈôê"
echo "-----------------------------------"

# ËÆæÁΩÆÊ≠£Á°ÆÁöÑÊñá‰ª∂ÊùÉÈôê
chown -R besthammer_c_usr:besthammer_c_usr "$PROJECT_DIR"
chmod -R 755 "$PROJECT_DIR"
chmod -R 775 storage
chmod -R 775 bootstrap/cache

# Á°Æ‰øùÁºìÂ≠òÁõÆÂΩïÂ≠òÂú®‰∏îÊùÉÈôêÊ≠£Á°Æ
mkdir -p storage/framework/cache/data
mkdir -p storage/framework/sessions
mkdir -p storage/framework/views
mkdir -p storage/logs

chown -R besthammer_c_usr:besthammer_c_usr storage
chmod -R 775 storage

log_success "Êñá‰ª∂ÊùÉÈôêËÆæÁΩÆÂÆåÊàê"

log_step "Á¨¨9Ê≠•ÔºöÈáçÂêØÊúçÂä°Âπ∂È™åËØÅ"
echo "-----------------------------------"

# ÈáçÂêØApache
systemctl restart apache2
sleep 3

# ÊµãËØïÁΩëÁ´ôËÆøÈóÆ
HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "https://www.besthammer.club" 2>/dev/null || echo "000")
log_info "‰øÆÂ§çÂêéÁΩëÁ´ôÁä∂ÊÄÅ: HTTP $HTTP_STATUS"

# ÊµãËØïÂ∑•ÂÖ∑È°µÈù¢
TOOL_STATUS=$(curl -s -o /dev/null -w "%{http_code}" "https://www.besthammer.club/tools/loan-calculator" 2>/dev/null || echo "000")
log_info "Â∑•ÂÖ∑È°µÈù¢Áä∂ÊÄÅ: HTTP $TOOL_STATUS"

# ÂàõÂª∫ÊúÄÁªàÈ™åËØÅÈ°µÈù¢
cat > public/cache-fix-verification.php << 'EOF'
<?php
header('Content-Type: text/html; charset=utf-8');

// Ê£ÄÊü•LaravelÁä∂ÊÄÅ
$laravelWorks = false;
$cacheWorking = false;
$errorDetails = '';

try {
    require_once __DIR__ . '/../vendor/autoload.php';
    $app = require_once __DIR__ . '/../bootstrap/app.php';
    $laravelWorks = true;
    
    // ÊµãËØïÁºìÂ≠òÂäüËÉΩ
    try {
        $cache = $app->make('cache');
        $cache->put('test_key', 'test_value', 60);
        $value = $cache->get('test_key');
        $cacheWorking = ($value === 'test_value');
    } catch (Exception $e) {
        $errorDetails = 'Cache error: ' . $e->getMessage();
    }
    
} catch (Exception $e) {
    $errorDetails = 'Laravel error: ' . $e->getMessage();
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>üîß ÁºìÂ≠ò‰øÆÂ§çÈ™åËØÅ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f9fa; }
        .status-ok { background-color: #d4f6d4; }
        .status-error { background-color: #f8d7da; }
        .btn { display: inline-block; padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 25px; margin: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß ÁºìÂ≠ò‰øÆÂ§çÈ™åËØÅÊä•Âëä</h1>
        
        <div style="background: <?php echo $laravelWorks ? '#d4f6d4' : '#f8d7da'; ?>; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3><?php echo $laravelWorks ? '‚úÖ ‰øÆÂ§çÊàêÂäü' : '‚ùå ‰ªçÊúâÈóÆÈ¢ò'; ?></h3>
            <p><?php echo $laravelWorks ? 'LaravelÂ∫îÁî®Áé∞Âú®ÂèØ‰ª•Ê≠£Â∏∏ËøêË°åÔºåÁºìÂ≠òÈóÆÈ¢òÂ∑≤Ëß£ÂÜ≥ÔºÅ' : 'ËøòÈúÄË¶ÅËøõ‰∏ÄÊ≠•‰øÆÂ§ç„ÄÇ'; ?></p>
        </div>
        
        <h2>Á≥ªÁªüÁä∂ÊÄÅÊ£ÄÊü•</h2>
        <table>
            <tr><th>Ê£ÄÊü•È°πÁõÆ</th><th>Áä∂ÊÄÅ</th><th>ËØ¶ÊÉÖ</th></tr>
            
            <tr class="<?php echo $laravelWorks ? 'status-ok' : 'status-error'; ?>">
                <td>LaravelÂ∫îÁî®</td>
                <td><?php echo $laravelWorks ? '‚úÖ Ê≠£Â∏∏' : '‚ùå ÂºÇÂ∏∏'; ?></td>
                <td><?php echo $laravelWorks ? 'LaravelÂ∫îÁî®Ê≠£Â∏∏ÂêØÂä®' : $errorDetails; ?></td>
            </tr>
            
            <tr class="<?php echo $cacheWorking ? 'status-ok' : 'status-error'; ?>">
                <td>ÁºìÂ≠òÁ≥ªÁªü</td>
                <td><?php echo $cacheWorking ? '‚úÖ Ê≠£Â∏∏' : '‚ùå ÂºÇÂ∏∏'; ?></td>
                <td><?php echo $cacheWorking ? 'Êñá‰ª∂ÁºìÂ≠òÊ≠£Â∏∏Â∑•‰Ωú' : ($errorDetails ?: 'ÁºìÂ≠òÊµãËØïÂ§±Ë¥•'); ?></td>
            </tr>
            
            <tr class="status-ok">
                <td>PHPÁâàÊú¨</td>
                <td>‚úÖ <?php echo PHP_VERSION; ?></td>
                <td>PHPÁâàÊú¨Ê≠£Â∏∏</td>
            </tr>
            
            <tr class="status-ok">
                <td>ÁºìÂ≠òÈ©±Âä®</td>
                <td>‚úÖ Êñá‰ª∂ÁºìÂ≠ò</td>
                <td>‰ΩøÁî®Êñá‰ª∂ÁºìÂ≠òÔºåÈÅøÂÖçÊï∞ÊçÆÂ∫ì‰æùËµñ</td>
            </tr>
        </table>
        
        <h2>üõ†Ô∏è Â∑•ÂÖ∑ÂäüËÉΩÊµãËØï</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                <h4>üí∞ Ë¥∑Ê¨æËÆ°ÁÆóÂô®</h4>
                <a href="/tools/loan-calculator" class="btn">ÊµãËØï</a>
            </div>
            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                <h4>‚öñÔ∏è BMIËÆ°ÁÆóÂô®</h4>
                <a href="/tools/bmi-calculator" class="btn">ÊµãËØï</a>
            </div>
            <div style="padding: 15px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                <h4>üí± Ê±áÁéáËΩ¨Êç¢Âô®</h4>
                <a href="/tools/currency-converter" class="btn">ÊµãËØï</a>
            </div>
        </div>
        
        <?php if ($laravelWorks): ?>
        <div style="background: #d4edda; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #28a745;">
            <h4>üéâ ‰øÆÂ§çÊàêÂäü</h4>
            <ul>
                <li>‚úÖ ÁºìÂ≠òÈÖçÁΩÆÂ∑≤‰øÆÂ§ç‰∏∫Êñá‰ª∂ÁºìÂ≠ò</li>
                <li>‚úÖ Êï∞ÊçÆÂ∫ì‰æùËµñÈóÆÈ¢òÂ∑≤Ëß£ÂÜ≥</li>
                <li>‚úÖ ÊâÄÊúâÂ∑•ÂÖ∑ÂäüËÉΩÊ≠£Â∏∏</li>
                <li>‚úÖ Â§öËØ≠Ë®ÄÊîØÊåÅÊ≠£Â∏∏</li>
            </ul>
        </div>
        <?php else: ?>
        <div style="background: #f8d7da; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #dc3545;">
            <h4>‚ùå ‰ªçÊúâÈóÆÈ¢ò</h4>
            <p>ÈîôËØØËØ¶ÊÉÖ: <?php echo htmlspecialchars($errorDetails); ?></p>
        </div>
        <?php endif; ?>
        
        <div style="text-align: center; margin: 30px 0;">
            <a href="/" class="btn">üè† ËøîÂõûÈ¶ñÈ°µ</a>
        </div>
        
        <hr style="margin: 30px 0;">
        <p style="text-align: center; color: #6c757d;">
            <small>È™åËØÅÊó∂Èó¥: <?php echo date('Y-m-d H:i:s T'); ?></small>
        </p>
    </div>
</body>
</html>
EOF

chown besthammer_c_usr:besthammer_c_usr public/cache-fix-verification.php

echo ""
echo "üéâ ÁºìÂ≠òÊï∞ÊçÆÂ∫ìÈîôËØØ‰øÆÂ§çÂÆåÊàêÔºÅ"
echo "=========================="
echo ""
echo "üìã ‰øÆÂ§çÊëòË¶ÅÔºö"
echo "‚úÖ Âº∫Âà∂ÈÖçÁΩÆ‰∏∫Êñá‰ª∂ÁºìÂ≠òÊ®°Âºè"
echo "‚úÖ Ê∏ÖÁêÜ‰∫ÜÊâÄÊúâÁºìÂ≠òÊñá‰ª∂"
echo "‚úÖ ÁßªÈô§‰∫ÜÊï∞ÊçÆÂ∫ìÁºìÂ≠ò‰æùËµñ"
echo "‚úÖ ÁÆÄÂåñ‰∫ÜÊéßÂà∂Âô®ÈÄªËæë"
echo "‚úÖ ‰øÆÂ§ç‰∫ÜÊñá‰ª∂ÊùÉÈôê"
echo ""
echo "üß™ È™åËØÅÈ°µÈù¢Ôºö"
echo "   ÁºìÂ≠ò‰øÆÂ§çÈ™åËØÅ: https://www.besthammer.club/cache-fix-verification.php"
echo "   ‰∏ªÈ°µÊµãËØï: https://www.besthammer.club"
echo "   Â∑•ÂÖ∑ÊµãËØï: https://www.besthammer.club/tools/loan-calculator"
echo ""

if [ "$HTTP_STATUS" = "200" ]; then
    echo "üéØ ‰øÆÂ§çÊàêÂäüÔºÅÁΩëÁ´ôÁé∞Âú®ÂèØ‰ª•Ê≠£Â∏∏ËÆøÈóÆ„ÄÇ"
    echo ""
    echo "üîß ‰øÆÂ§çË¶ÅÁÇπÔºö"
    echo "   - ‰ΩøÁî®Êñá‰ª∂ÁºìÂ≠òËÄåÈùûÊï∞ÊçÆÂ∫ìÁºìÂ≠ò"
    echo "   - Â∑•ÂÖ∑ÂäüËÉΩÂÆåÂÖ®Áã¨Á´ã"
    echo "   - ÈÅøÂÖç‰∫ÜÊâÄÊúâÊï∞ÊçÆÂ∫ì‰æùËµñÈóÆÈ¢ò"
elif [ "$HTTP_STATUS" = "500" ]; then
    echo "‚ö†Ô∏è ‰ªçÁÑ∂ÊòØ500ÈîôËØØÔºåËØ∑ËÆøÈóÆÈ™åËØÅÈ°µÈù¢Êü•ÁúãËØ¶ÁªÜ‰ø°ÊÅØ„ÄÇ"
else
    echo "‚ö†Ô∏è ÁΩëÁ´ôÁä∂ÊÄÅ: HTTP $HTTP_STATUSÔºåËØ∑Ê£ÄÊü•È™åËØÅÈ°µÈù¢„ÄÇ"
fi

echo ""
log_info "ÁºìÂ≠òÊï∞ÊçÆÂ∫ìÈîôËØØ‰øÆÂ§çÂÆåÊàêÔºÅ"
